<!DOCTYPE html>
<html lang="en-US">
  <head>
  <meta charset="utf-8" />
  <title>The Organge+</title>

  <meta name="author" content="Dung Nguyen" />
  <meta
    name="description"
    content=""
  />

  <!-- mobile responsive meta -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=5"
  />

  <!-- Favicon -->
  <link
    rel="icon"
    href="/images/favicon.png"
    type="image/x-icon"
  />

  <!-- CSS Plugins -->
  <!-- plugins + stylesheet -->
<link rel="preconnect" href="https://fonts.gstatic.com" />
 
<link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css" media="screen" />
  
<link rel="stylesheet" href="/css/style.css" media="screen" />
  
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;700&display=swap" />
 


  
  <script type=application/javascript>
   var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-40665301-3','auto'),ga('send','pageview'))</script>
  

</head>


  <body>
    <div style="min-height: calc(100vh - 65px)">
      <div class="header-height-fix"></div>
<header class="header-nav">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
          <a class="navbar-brand font-weight-bold mr-0" href="">
            
            <img
              loading="lazy"
              src="/images/logo.png"
              alt="The Organge+"
              height="35px"
            />
            
          </a>

          
          <button
            class="search-toggle d-inline-block d-lg-none ml-auto mr-3"
            data-toggle="search"
            aria-label="Search Toggle"
          >
            <i data-eva="search-outline"></i>
          </button>
          

          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navHeader"
            aria-controls="navHeader"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i data-eva="menu-outline"></i>
            <i class="d-none" data-eva="close-outline"></i>
          </button>

          <div class="collapse navbar-collapse" id="navHeader">
            <ul
              class="navbar-nav mx-auto"
            >
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/">Blog</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/tags">Tags</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/about">About me</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle d-inline-block "
                  href="#"
                  role="button"
                  data-toggle="dropdown"
                  aria-expanded="false"
                  >More</a
                >
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item "
                      href="/categories"
                      >Category</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/elements"
                      >Elements</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/privacy"
                      >Privacy</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/terms-conditions"
                      >Terms & Conditions</a
                    >
                  </li></ul>
              </li>
              
              
              
            </ul>

            
            <div class="navbar-right d-none d-lg-inline-block">
              <ul class="social-links list-unstyled list-inline">
                <li class="list-inline-item ml-4 d-none d-lg-inline-block">
                  <button
                    class="search-toggle"
                    data-toggle="search"
                    aria-label="Search Toggle"
                  >
                    <i data-eva="search-outline"></i>
                  </button>
                </li>
              </ul>
            </div>
            
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>


<div class="search-block">
  <div data-toggle="search-close">
    <i data-eva="close-outline" class="text-primary"></i>
  </div>
  <form action="/search/">
    <input
      id="search-query"
      name="s"
      type="search"
      placeholder="Type words &amp; hit enter"
      class="text-center"
      aria-label="search-query"
    />
  </form>
</div>



      

      <!-- checking blog -->



<section class="section-sm">
  <div class="container">
    <div class="row justify-content-center">
      <div
        class=" col-lg-10 "
      >
        <div class="pr-lg-4">
          <div class="single-post">
            <div class="text-center mb-5">
              <h1 class="mb-4 post-title">Elixir - Lưu trữ dữ liệu trên RAM với ETS</h1>
              <ul class="card-meta list-inline">
                <li class="list-inline-item">
                  <a href="#!" class="card-meta-author"><a href="/author/dung-nguyen" class="card-meta-author">
                      <img
                        loading="lazy"
                        src="/images/author/dung-nguyen.jpg"
                        alt="Dung Nguyen"
                      />
                      <span>Dung Nguyen</span>
                    </a>
                  </a>
                </li>
                <li class="list-inline-item">|</li>
                <li class="list-inline-item">
                  <span>2018-05-12T14:28:22+07:00</span>
                </li>
              </ul>
            </div>

            

            <div class="content"><h2>
ETS là gì?</h2>
<p>
Có lẽ các bạn đã nghe qua về <code class="inline">redis</code> hoặc <code class="inline">memcache</code>, hoặc là cả hai. Còn nếu bạn chưa nghe tới bao giờ thì đó là những cơ sở dữ liệu lưu trữ trên RAM với ưu điểm là tốc độ truy xuất cực kỳ nhanh. ETS - Erlang Term Service - cũng là một CSDL lưu trữ trên RAM (in-ram DB) nhưng khác ở chỗ là ETS có sẵn khi cài Elixir/Erlang và bạn chẳng phải mất công cài đặt, cấu hình như 2 anh trên kia, nhà trồng được việc gì phải ngại.</p>
<p>
<strong>Đặc điểm</strong> của em nó là:</p>
<ul>
  <li>
Không cần cài đặt   </li>
  <li>
Dữ liệu lưu trữ trên RAM và mất đi khi process kết thúc  </li>
  <li>
Dữ liệu lưu trữ dạng <code class="inline">key-value</code>  </li>
  <li>
<code class="inline">value</code> có thể là <code class="inline">set</code>, <code class="inline">ordered_set</code>, <code class="inline">bag</code>, <code class="inline">duplicated_bag</code>  </li>
  <li>
Kiểu dữ liệu của <code class="inline">value</code> trên cùng 1 bảng là giống nhau và đuợc khai báo khi tạo bảng.  </li>
</ul>
<h2>
Các thao tác trong ETS</h2>
<h3>
1. Tạo bảng</h3>
<pre><code class="elixir">iex&gt; :ets.new(:cache, [:set, :protected, :named_table])</code></pre>
<p>
<strong>Syntax: </strong> <code class="inline">:ets.new(ten_bang, [type, access, name_table])</code></p>
<ul>
  <li>
<code class="inline">type</code> là kiểu dữ liệu của <code class="inline">value</code> lưu trong bảng    <ul>
      <li>
<code class="inline">set</code> là kiểu dữ liệu, chú này chung thuỷ chỉ có 1 value cho 1 key và key là duy nhất, không bị trùng.      </li>
      <li>
<code class="inline">ordered_set</code> thằng em nghiêm túc của <code class="inline">set</code>, khác thằng anh ở chỗ đuợc tự động order khi thêm data vào.      </li>
      <li>
<code class="inline">bag</code> khác với <code class="inline">set</code> ở chỗ chú này chơi harem, cho phép nhiều value cho cùng 1 key, tuy nhiên các value không đuợc trùng nhau.      </li>
      <li>
<code class="inline">duplicated_bag</code> thằng này ăn tạp giống <code class="inline">bag</code> nhưng cho phép value trùng nhau      </li>
    </ul>
  </li>
  <li>
<code class="inline">access</code>  giới hạn khả năng truy xuất dữ liệu từ bảng, cũng khá dễ nhớ    <ul>
      <li>
<code class="inline">public</code>: hàng công cộng, chú process nào thích nhìn (đọc), sờ (ghi) gì anh cho hết      </li>
      <li>
<code class="inline">protected</code>: các chú chỉ đuợc nhìn thôi, anh sở hữu thì anh đuợc sờ      </li>
      <li>
<code class="inline">private</code>: anh giấu hết, chỉ có anh mới đuợc nhìn và sờ, các chú đi ra chỗ khác      </li>
    </ul>
  </li>
  <li>
<code class="inline">named_table</code> Cái này tuỳ chọn, bình thuờng thì sẽ trả về 1 id dùng để truy xuất vào table. Nếu thêm option này vào thì có thể dùng <code class="inline">ten_bang</code> để truy xuất vào table.  </li>
</ul>
<p>
Đã xong phần khởi tạo, giờ phần hay ho nhất đây.</p>
<h3>
2. Insert và update dữ liệu</h3>
<ul>
  <li>
    <p>
Insert dữ liệu nếu <code class="inline">key</code> đã có chủ thì ghi đè (đập chậu cuớp bông)    </p>
    <pre><code class="elixir">  iex&gt; :ets.insert(:cache, {&quot;post-1&quot;, &quot;world!&quot;, %{view: 1}})
  true</code></pre>
  </li>
  <li>
    <p>
Insert dữ liệu, nếu <code class="inline">key</code> đã có chủ thì bỏ qua.    </p>
    <pre><code class="elixir">  iex&gt; :ets.insert_new(:cache, {&quot;post-1&quot;, &quot;Lao!&quot;, %{view: 2}})
  false
  iex&gt; :ets.insert_new(:cache, {&quot;post-2&quot;, &quot;Vietnam!&quot;, %{view: 999}})
  true</code></pre>
  </li>
</ul>
<p>
Dữ liệu cho hàm <code class="inline">insert/2</code> và <code class="inline">insert_new/2</code> là 1 <code class="inline">tuple</code>, phần tử đầu tiên của <code class="inline">tuple</code> mặc định được dùng làm <code class="inline">key</code>.</p>
<h3>
3. Query dữ liệu</h3>
<p>
<strong>3.1 Query đơn giản</strong>: tìm kiếm dữ liệu theo key dùng hàm <code class="inline">lookup/2</code></p>
<pre><code class="elixir">iex&gt; :ets.lookup(:cache, &quot;post-1&quot;)
[{&quot;post-1&quot;, &quot;world!&quot;, %{view: 1}}]</code></pre>
<p>
<strong>3.2 Query với nhiều trường dữ liệu</strong> với hàm <code class="inline">match_object/2</code></p>
<pre><code class="elixir">iex&gt; :ets.match_object(:cache, {:&quot;_&quot;, &quot;Vietnam!&quot;, :&quot;_&quot;})
[{&quot;post-2&quot;, &quot;Vietnam!&quot;, %{view: 999}}]</code></pre>
<ul>
  <li>
<strong>Note</strong> <code class="inline">:&quot;_&quot;</code> đánh dấu tại vị trí này sẽ không xài để match dữ liệu, truờng này chứa dữ liệu gì cũng đuợc, anh không quan tâm  </li>
</ul>
<p>
<strong>3.3 Select trường dữ liệu nào sẽ trả về</strong> với <code class="inline">match/2</code></p>
<pre><code class="elixir">iex&gt; :ets.match_object(:cache, {:&quot;$1&quot;, :&quot;$2&quot;, :&quot;_&quot;})
[{&quot;post-1&quot;, &quot;world!&quot;}, {&quot;post-2&quot;, &quot;Vietnam!&quot;}]</code></pre>
<ul>
  <li>
<strong>Note</strong> <code class="inline">:&quot;$N&quot;</code>  dùng để <code class="inline">select</code> kết quả trả về,  <code class="inline">N</code> là một số nguyên dùng để xác định vị trí của dữ liệu trong kết quả.  </li>
</ul>
<pre><code class="elixir">iex&gt; :ets.match_object(:cache, {:&quot;$30&quot;, :&quot;$2&quot;, :&quot;_&quot;})
[{&quot;world!&quot;, &quot;post-1&quot;}, {&quot;Vietnam!&quot;, &quot;post-2&quot;}]</code></pre>
<p>
<strong>3.4 Giới hạn kết quả tra về</strong></p>
<p>
Sử dụng hàm <code class="inline">match/3</code> hoặc <code class="inline">match_object/3</code> tương tự như <code class="inline">match/2</code> và <code class="inline">match_object/2</code>, trong đó tham số thứ 3 là số lượng phần tử sẽ trả về.</p>
<pre><code class="elixir"># them 1 phan tu
iex&gt; :ets.insert_new(:cache, {&quot;post-3&quot;, &quot;Vietnam!&quot;, %{view: 1000}})
true

# khong limit
iex&gt; :ets.match_object(:cache, {:&quot;_&quot;, &quot;Vietnam!&quot;, :&quot;_&quot;})
[{&quot;post-2&quot;, &quot;Vietnam!&quot;, %{view: 999}}, {&quot;post-3&quot;, &quot;Vietnam!&quot;, %{view: 1000}}]

# co limit
iex&gt; :ets.match_object(:cache, {:&quot;_&quot;, &quot;Vietnam!&quot;, :&quot;_&quot;}, 1)
[{&quot;post-2&quot;, &quot;Vietnam!&quot;, %{view: 999}}]</code></pre>
<h3>
4. Xoá dữ liệu</h3>
<p>
<strong>Xoá theo key</strong></p>
<pre><code class="elixir">iex&gt; :ets.delete(:cache, &quot;post-1&quot;)
true</code></pre>
<p>
<strong>Match dữ liệu và xoá</strong>. Cách match giống như trong <strong>query dữ liệu</strong></p>
<pre><code class="elixir">iex&gt; :ets.match_delete(:cache, {:&quot;_&quot;, &quot;Vietnam!&quot;, :&quot;_&quot;})
true</code></pre>
<h3>
5. Xoá bảng</h3>
<pre><code class="elixir">iex&gt; :ets.delete(:cache)
true</code></pre>
<p>
Nếu không xoá thì dữ liệu sẽ tồn tại cho đến khi process kết thúc mới bị mất đi.</p>
<h3>
6. Các hàm hay xài</h3>
<ul>
  <li>
<code class="inline">member/2</code> kiểm tra xem key đã tồn taị trong bảng hay chưa  </li>
  <li>
<code class="inline">tab2list</code>: đọc tất cả dữ liệu của bảng vào 1 list  </li>
  <li>
<code class="inline">tab2file</code>: lưu tất cả dữ liệu trên bảng vào 1 file, bạn có thể lưu dữ liệu lại <strong>truớc khi process kết thúc</strong> và có thể xài lại dữ liệu sau.  </li>
  <li>
<code class="inline">file2tab</code> : đọc 1 file đuợc lưu bởi <code class="inline">tab2file</code> và tạo lại bảng tương ứng   </li>
  <li>
<code class="inline">to_dest/2</code>: copy toàn bộ dữ liệu từ bảng ETS qua bảng DETS (lưu dữ liệu trên ổ cứng)  </li>
  <li>
<code class="inline">from_dest/2</code>: copy toàn bộ dữ liệu từ bảng DETS qua bảng ETS  </li>
</ul>
<h2>
Tham khảo</h2>
<ol>
  <li>
<a href="http://erlang.org/doc/man/ets.html">http://erlang.org/doc/man/ets.html</a> xem nhiều trò hay  </li>
  <li>
<a href="http://learnyousomeerlang.com/ets">http://learnyousomeerlang.com/ets</a>   </li>
  <li>
Ngoài ra Erlang còn hỗ trợ <code class="inline">DETS</code> (disk-based term storage) lưu trên ổ cứng với API tương tự <a href="http://erlang.org/doc/man/dets.html">http://erlang.org/doc/man/dets.html</a>  </li>
</ol>
</div>
          </div>

          <!-- Post meta -->
          <div class="single-post-meta">
            <div class="row justify-content-center">
              <div class="col-md-6 text-center text-md-left">
                <ul class="post-meta-tags list-unstyled list-inline">
                  
                  <li class="list-inline-item">
                    <a href="/tagselixir">#elixir</a>
                  </li>
                  
                  <li class="list-inline-item">
                    <a href="/tagserlang">#erlang</a>
                  </li>
                  
                </ul>
              </div>
              <div class="col-md-6 text-center text-md-right mt-4 mt-md-0">
<ul
  class="social-links has-bg-color list-unstyled list-inline"
  style="line-height: 0"
>
  <li class="list-inline-item">
    <!-- Sharingbutton Facebook -->
    <a
      class="resp-sharing-button__link d-block"
      href="https://facebook.com/sharer/sharer.php?u=/blog/2018-05-12-Erlang-term-storage"
      target="_blank"
      rel="noopener"
      aria-label=""
    >
      <div
        class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"
      >
        <div
          aria-hidden="true"
          class="resp-sharing-button__icon resp-sharing-button__icon--solid"
        >
          <i data-eva="facebook-outline" class="text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    <!-- Sharingbutton Twitter -->
    <a
      class="resp-sharing-button__link d-block"
      href="https://twitter.com/intent/tweet/?text=Elixir - Lưu trữ dữ liệu trên RAM với ETS&amp;url=/blog/2018-05-12-Erlang-term-storage"
      target="_blank"
      rel="noopener"
      aria-label=""
    >
      <div
        class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"
      >
        <div
          aria-hidden="true"
          class="resp-sharing-button__icon resp-sharing-button__icon--solid"
        >
          <i data-eva="twitter-outline" class="text-dark"></i>
        </div>
      </div>
    </a>
  </li>
</ul>
</div>
            </div>
          </div>

          <div class="single-post-author">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="media d-block d-sm-flex text-center text-sm-left">
                  <a href="/author/dung-nguyen"
                    ><img
                      loading="lazy"
                      class="img-fluid rounded-circle mr-0 mr-sm-4 mb-4"
                      src="/images/author/dung-nguyen.jpg"
                      alt="Dung Nguyen"
                  /></a>
                  <div class="media-body">
                    <h4>
                      <a href="/author/dung-nguyen" class="text-dark font-weight-700"
                        >Dung Nguyen</a
                      >
                    </h4>
                    <p class="font-primary"><p>
Hi! I’m Dung Nguyen. I’m an Elixir developer at OnPoint Vietnam.</p>
</p>
                    <ul
                      class="social-links list-unstyled list-inline ml-0 ml-sm-n2"
                    >
                      
                      <li class="list-inline-item">
                        <a href="https://www.linkedin.com/in/dung-nguyen-tien-695ba135/">
                          <i class="lab linkedin-outline"></i>
                        </a>
                      </li>
                      
                      <li class="list-inline-item">
                        <a href="https://www.github.com/bluzky">
                          <i class="lab github-outline"></i>
                        </a>
                      </li>
                      
                      <li class="list-inline-item">
                        <a href="https://dev.to/bluzky">
                          <i class="lab book-outline"></i>
                        </a>
                      </li>
                      
                    </ul>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>

          <!-- DISQUS comment -->
          
          <div class="single-post-similer">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="row mt-3">
                  <div id="disqus_thread" class="w-100"></div>
                </div>
              </div>
            </div>
          </div>
          

          <div class="single-post-similer">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="row mt-3">
                  <div class="col-12">
                    <h3 class="text-dark font-weight-800 mb-4 pb-2">
                      You May Also Like
                    </h3>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      
    </div>
  </div>
</section>



    </div>
    <footer class="section-sm p-0">
  <div class="container">
    <div class="row justify-content-center align-items-center">
      <div class="col-lg-5">
         
      </div>
      <div class="col-lg-12 text-center mb-3">
        
        <ul
          class="social-links icon-box list-unstyled list-inline font-weight-500 mb-3"
        >
          
        </ul>

        <p class="mb-0 font-weight-500 copyright-text content">
          <p>
Blog by Dung Nguyen.Theme by <a href="https://gethugothemes.com/">Gethugothemes</a></p>

        </p>
      </div>
    </div>
  </div>
</footer>

    <!-- JS Plugins + Main script -->


<script data-turbolinks-suppress-warning src="/plugins/jquery/jquery.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/plugins/bootstrap/bootstrap.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/plugins/search/fuse.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/plugins/search/mark.js"></script>
 

<script data-turbolinks-suppress-warning src="/plugins/search/search.js"></script>
 

<script src="https://unpkg.com/eva-icons"></script>
 

<script
  data-turbolinks-suppress-warning
  src="/js/script.js"
></script>

<!-- cookie -->


<!-- DISQUS -->

<script>
  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
  /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
  */
  (function () {
    // DON'T EDIT BELOW THIS LINE
    var d = document,
      s = d.createElement("script");
    s.src = "https://.disqus.com/embed.js";
    s.setAttribute("data-timestamp", +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>


  </body>
</html>
