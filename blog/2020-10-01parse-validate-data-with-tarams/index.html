<!DOCTYPE html>
<html lang="en-US">
  <head>
  <meta charset="utf-8" />
  <title>The Organge+</title>

  <meta name="author" content="Dung Nguyen" />
  <meta
    name="description"
    content=""
  />

  <!-- mobile responsive meta -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=5"
  />

  <!-- Favicon -->
  <link
    rel="icon"
    href="/ego/images/favicon.png"
    type="image/x-icon"
  />

  <!-- CSS Plugins -->
  <!-- plugins + stylesheet -->
<link rel="preconnect" href="https://fonts.gstatic.com" />
 
<link rel="stylesheet" href="/ego/plugins/bootstrap/bootstrap.min.css" media="screen" />
  
<link rel="stylesheet" href="/ego/css/style.css" media="screen" />
  
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;700&display=swap" />
 


  
  <script type=application/javascript>
   var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-40665301-3','auto'),ga('send','pageview'))</script>
  

</head>


  <body>
    <div style="min-height: calc(100vh - 65px)">
      <div class="header-height-fix"></div>
<header class="header-nav">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <nav class="navbar navbar-expand-lg navbar-light p-0">
          <a class="navbar-brand font-weight-bold mr-0" href="">
            
            <img
              loading="lazy"
              src="/ego/images/logo.png"
              alt="The Organge+"
              height="35px"
            />
            
          </a>

          
          <button
            class="search-toggle d-inline-block d-lg-none ml-auto mr-3"
            data-toggle="search"
            aria-label="Search Toggle"
          >
            <i data-eva="search-outline"></i>
          </button>
          

          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navHeader"
            aria-controls="navHeader"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i data-eva="menu-outline"></i>
            <i class="d-none" data-eva="close-outline"></i>
          </button>

          <div class="collapse navbar-collapse" id="navHeader">
            <ul
              class="navbar-nav mx-auto"
            >
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/ego">Blog</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/ego/tags">Tags</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item ">
                <a class="nav-link" href="/ego/about">About me</a>
              </li>
              
              
              
              
              

              
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle d-inline-block "
                  href="#"
                  role="button"
                  data-toggle="dropdown"
                  aria-expanded="false"
                  >More</a
                >
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item "
                      href="/ego/categories"
                      >Category</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/ego/elements"
                      >Elements</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/ego/privacy"
                      >Privacy</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item "
                      href="/ego/terms-conditions"
                      >Terms & Conditions</a
                    >
                  </li></ul>
              </li>
              
              
              
            </ul>

            
            <div class="navbar-right d-none d-lg-inline-block">
              <ul class="social-links list-unstyled list-inline">
                <li class="list-inline-item ml-4 d-none d-lg-inline-block">
                  <button
                    class="search-toggle"
                    data-toggle="search"
                    aria-label="Search Toggle"
                  >
                    <i data-eva="search-outline"></i>
                  </button>
                </li>
              </ul>
            </div>
            
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>


<div class="search-block">
  <div data-toggle="search-close">
    <i data-eva="close-outline" class="text-primary"></i>
  </div>
  <form action="/search/">
    <input
      id="search-query"
      name="s"
      type="search"
      placeholder="Type words &amp; hit enter"
      class="text-center"
      aria-label="search-query"
    />
  </form>
</div>



      

      <!-- checking blog -->



<section class="section-sm">
  <div class="container">
    <div class="row justify-content-center">
      <div
        class=" col-lg-10 "
      >
        <div class="pr-lg-4">
          <div class="single-post">
            <div class="text-center mb-5">
              <h1 class="mb-4 post-title">Chuẩn hoá và validate dữ liệu trong Phoenix với thư viện Tarams</h1>
              <ul class="card-meta list-inline">
                <li class="list-inline-item">
                  <a href="#!" class="card-meta-author"><a href="/ego/author/dung-nguyen" class="card-meta-author">
                      <img
                        loading="lazy"
                        src="/ego/images/author/dung-nguyen.jpg"
                        alt="Dung Nguyen"
                      />
                      <span>Dung Nguyen</span>
                    </a>
                  </a>
                </li>
                <li class="list-inline-item">|</li>
                <li class="list-inline-item">
                  <span>2020-10-01</span>
                </li>
              </ul>
            </div>

            
            <div class="mb-5 text-center">
              <img
                loading="lazy"
                class="img-fluid rounded"
                src="/ego/img/tarams-parse.png"
                alt="Image not Found"
              />
            </div>
            

            <div class="content"><p>
**Version mới của thư viện <code class="inline">Tarams</code> không tương thích với bản cũ. Các bạn đọc bài mới ở đây nhé <a href="/blog/2021-08-14-validate-request-params-with-phoenix">How to validate request params in Phoenix</a></p>
<p>
Yêu cầu chuẩn hoá và validate các tham số truyền lên từ client là yêu cầu cơ bản khi xây dựng API Web. Mình đã có một bài hướng dẫn sử dụng Ecto.Changeset để chuẩn hoá trong bài viết này:</p>
<p>
<a href="https://dev.to/bluzky/parse-va-validate-request-param-trong-phoenix-v-i-ecto-151a">Parse và validate request param trong Phoenix với Ecto </a></p>
<p>
Trong bài viết này, mình sẽ hướng dẫn một cách ngắn và đơn giản hơn bằng cách sử dụng thư viện sẵn có <a href="https://github.com/bluzky/tarams/">Tarams</a>. Thư viện này thực ra là sử dụng lại <code class="inline">Ecto.Changeset</code> nhưng nó giúp cho chúng ta không phải lặp lại quá nhiều code như khi dùng <code class="inline">Ecto.Changeset</code></p>
<p>
Một vài tính năng thú vị của Tarams:</p>
<ul>
  <li>
Cung cấp cách thức đơn giản để định nghĩa các cấu trúc tham số  </li>
  <li>
Cho phép định nghĩa các giá trị default động  </li>
  <li>
Cho phép định nghĩa các hàm để cast giá trị về đúng kiểu dữ liệu  </li>
  <li>
Định nghĩa hàm để validate dữ liệu  </li>
</ul>
<p>
Sau đây là cách sử dụng <code class="inline">Tarams</code>. Ví dụ chúng ta đang viết API để cập nhật profile của nhân viên. Yêu cầu là</p>
<pre><code>email: bắt buộc, đúng định dạng
first_name: bắt buộc
last_name: bắt buộc
birthday: không bắt buộc, kiểu ngày tháng
title: không bắt buộc
start_date: ngày bắt đầu làm việc, ngày tháng, mặc định là ngày hiện tại</code></pre>
<h2>
1. Định nghĩa cấu trúc của tham số truyền lên khá đơn giản</h2>
<pre><code class="elixir">@schema  %{
    email: [type: :string],
    first_name: [type: :string],
    last_name: [type: :string],
    title: :string,
    birth_day: [type: :date],
    start_date: [type: :date]
}</code></pre>
<p>
Schema đơn giản chỉ là một map với key là tên field và value là 1 list option của field đó.</p>
<h2>
2. Bây giờ thêm các ràng buộc</h2>
<ul>
  <li>
Để đánh dấu 1 trường là bắt buộc, thêm option <code class="inline">required: true</code>  </li>
  <li>
<code class="inline">Taram</code> cũng cho phép validate data sử dụng lại các hàm validate của <code class="inline">Changeset</code>  </li>
</ul>
<pre><code class="elixir">@schema  %{
    email: [type: :string, required: true, validate: {:format, ~r/@/}],
    first_name: [type: :string, required: true],
    last_name: [type: :string, required: true],
    title: :string,
    birth_day: [type: :date],
    start_date: [type: :date]
}</code></pre>
<h2>
3. Bây giờ thì set các giá trị default</h2>
<p>
<code class="inline">default</code> có thể là 1 giá trị hoặc 1 hàm. Mỗi khi parse tham số thì hàm này sẽ được gọi để lấy giá trị mặc định</p>
<pre><code class="elixir">@schema  %{
    ...
    title: [type: :string, default: &quot;staff&quot;],
    birth_day: [type: :date],
    start_date: [type: :date, default: &amp;Timex.today/0]
}</code></pre>
<h2>
4. Cast các giá trị tham số về đúng kiểu</h2>
<p>
Nhiều các giá trị tham số truyền lên phải được chuyển về đúng các loại dữ liệu phức tạp như ngày tháng, list.
Ví dụ ngày tháng truyền lên là string <code class="inline">01/12/1994</code> thì phải chuyển về kiểu date để sử dụng lại được. Tarams hỗ trợ định nghĩa 1 hàm custom để cast giá trị, hàm này trả về </p>
<ul>
  <li>
<code class="inline">{:ok, value}</code> nếu parse thành công  </li>
  <li>
<code class="inline">{:error, error_message}</code> nếu thất bại  </li>
</ul>
<pre><code class="elixir">def parse_date(date_str) do
    Timex.parse(date_str, &quot;{0D}/{0M}/{YYYY}&quot;)
end

@schema  %{
    ...
    title: [type: :string, default: &quot;staff&quot;],
    birth_day: [type: :date, cast_func: &amp;parse_date/1],
    start_date: [type: :date, default: &amp;Timex.today/0]
}</code></pre>
<h2>
5. Bây giờ sử dụng nào</h2>
<pre><code class="elixir">def update(conn, params) do
    with {:ok, user_data} &lt;- Tarams.parse(@schema, params) do
        # do anything with your params
        # access data bằng atom key: user_data.email
    else
        {:error, changset} -&gt; # return params error
    end
end</code></pre>
<p>
Hàm <code class="inline">parse</code> sẽ parse và validate dữ liệu. Nếu mọi thứ đều ổn, sẽ trả về <code class="inline">{:ok, data}</code> và ngược lại thì trả về <code class="inline">{:error, changeset}</code>.</p>
<p>
Done! Code của bạn sẽ trở nên đơn giản và ngắn gọn hơn nhiều</p>
</div>
          </div>

          <!-- Post meta -->
          <div class="single-post-meta">
            <div class="row justify-content-center">
              <div class="col-md-6 text-center text-md-left">
                <ul class="post-meta-tags list-unstyled list-inline">
                  
                  <li class="list-inline-item">
                    <a href="/ego/tagselixir">#elixir</a>
                  </li>
                  
                  <li class="list-inline-item">
                    <a href="/ego/tagsecto">#ecto</a>
                  </li>
                  
                  <li class="list-inline-item">
                    <a href="/ego/tagsphoenix">#phoenix</a>
                  </li>
                  
                  <li class="list-inline-item">
                    <a href="/ego/tagstarams">#tarams</a>
                  </li>
                  
                </ul>
              </div>
              <div class="col-md-6 text-center text-md-right mt-4 mt-md-0">
<ul
  class="social-links has-bg-color list-unstyled list-inline"
  style="line-height: 0"
>
  <li class="list-inline-item">
    <!-- Sharingbutton Facebook -->
    <a
      class="resp-sharing-button__link d-block"
      href="https://facebook.com/sharer/sharer.php?u=/ego/blog/2020-10-01parse-validate-data-with-tarams"
      target="_blank"
      rel="noopener"
      aria-label=""
    >
      <div
        class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"
      >
        <div
          aria-hidden="true"
          class="resp-sharing-button__icon resp-sharing-button__icon--solid"
        >
          <i data-eva="facebook-outline" class="text-dark"></i>
        </div>
      </div>
    </a>
  </li>

  <li class="list-inline-item">
    <!-- Sharingbutton Twitter -->
    <a
      class="resp-sharing-button__link d-block"
      href="https://twitter.com/intent/tweet/?text=Chuẩn hoá và validate dữ liệu trong Phoenix với thư viện Tarams&amp;url=/ego/blog/2020-10-01parse-validate-data-with-tarams"
      target="_blank"
      rel="noopener"
      aria-label=""
    >
      <div
        class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"
      >
        <div
          aria-hidden="true"
          class="resp-sharing-button__icon resp-sharing-button__icon--solid"
        >
          <i data-eva="twitter-outline" class="text-dark"></i>
        </div>
      </div>
    </a>
  </li>
</ul>
</div>
            </div>
          </div>

          <div class="single-post-author">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="media d-block d-sm-flex text-center text-sm-left">
                  <a href="/ego/author/dung-nguyen"
                    ><img
                      loading="lazy"
                      class="img-fluid rounded-circle mr-0 mr-sm-4 mb-4"
                      src="/ego/images/author/dung-nguyen.jpg"
                      alt="Dung Nguyen"
                  /></a>
                  <div class="media-body">
                    <h4>
                      <a href="/ego/author/dung-nguyen" class="text-dark font-weight-700"
                        >Dung Nguyen</a
                      >
                    </h4>
                    <p class="font-primary"><p>
Hi! I’m Dung Nguyen. I’m an Elixir developer at OnPoint Vietnam.</p>
</p>
                    <ul
                      class="social-links list-unstyled list-inline ml-0 ml-sm-n2"
                    >
                      
                      <li class="list-inline-item">
                        <a href="https://www.linkedin.com/in/dung-nguyen-tien-695ba135/">
                          <i class="lab linkedin-outline"></i>
                        </a>
                      </li>
                      
                      <li class="list-inline-item">
                        <a href="https://www.github.com/bluzky">
                          <i class="lab github-outline"></i>
                        </a>
                      </li>
                      
                      <li class="list-inline-item">
                        <a href="https://dev.to/bluzky">
                          <i class="lab book-outline"></i>
                        </a>
                      </li>
                      
                    </ul>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>

          <!-- DISQUS comment -->
          
          <div class="single-post-similer">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="row mt-3">
                  <div id="disqus_thread" class="w-100"></div>
                </div>
              </div>
            </div>
          </div>
          

          <div class="single-post-similer">
            <div class="row justify-content-center">
              <div class="col-md-12">
                <div class="row mt-3">
                  <div class="col-12">
                    <h3 class="text-dark font-weight-800 mb-4 pb-2">
                      You May Also Like
                    </h3>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      
    </div>
  </div>
</section>



    </div>
    <footer class="section-sm p-0">
  <div class="container">
    <div class="row justify-content-center align-items-center">
      <div class="col-lg-5">
         
      </div>
      <div class="col-lg-12 text-center mb-3">
        
        <ul
          class="social-links icon-box list-unstyled list-inline font-weight-500 mb-3"
        >
          
        </ul>

        <p class="mb-0 font-weight-500 copyright-text content">
          <p>
Blog by Dung Nguyen.Theme by <a href="https://gethugothemes.com/">Gethugothemes</a></p>

        </p>
      </div>
    </div>
  </div>
</footer>

    <!-- JS Plugins + Main script -->


<script data-turbolinks-suppress-warning src="/ego/plugins/jquery/jquery.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/ego/plugins/bootstrap/bootstrap.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/ego/plugins/search/fuse.min.js"></script>
 

<script data-turbolinks-suppress-warning src="/ego/plugins/search/mark.js"></script>
 

<script data-turbolinks-suppress-warning src="/ego/plugins/search/search.js"></script>
 

<script src="https://unpkg.com/eva-icons"></script>
 

<script
  data-turbolinks-suppress-warning
  src="/ego/js/script.js"
></script>

<!-- cookie -->


<!-- DISQUS -->

<script>
  /**
   *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
   *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
  /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
  */
  (function () {
    // DON'T EDIT BELOW THIS LINE
    var d = document,
      s = d.createElement("script");
    s.src = "https://.disqus.com/embed.js";
    s.setAttribute("data-timestamp", +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>


  </body>
</html>
